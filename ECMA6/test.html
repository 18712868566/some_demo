﻿﻿<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
</head>
<body>

<script>
    function require(url) {
        // 去拿取加载的信息
        let text = sync(url)
        // 前后添加一些字符串，封装成一个函数，用括号括起来表示是一个表达式
        text = '(function(module){' + text + '})'
        // eval这个字符串，把他变为一个真函数
        let fn = eval(text)
        // 调用这个函数，并将module这个对象作为参数传进去
        // 这样module就可以拿到导出的数据了
        let module = {}
        fn(module)
        // 我们是通过module.exports导出的，所以返回他
        return module.exports
    }

    // 因为是CommonJS是同步的，因此用本函数模拟同步加载
    function sync(url) {
        // 省去加载文件的过程，直接输出返回结果
        return `module.exports = {
foo(){
    console.log('foo')
},
bar: 'bar'
}`
    }

    let myModel = require('test')
    myModel.foo()
    console.log(myModel.bar)

</script>
</body>
</html>